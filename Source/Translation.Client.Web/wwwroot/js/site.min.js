function getPathFromUrl(n){return n.split("?")[0]}function clearChildren(n){while(n.firstChild)n.removeChild(n.firstChild)}function createElement(n){return document.createElement(n)}function getElement(n){return document.getElementById(n)}function getValue(n){return document.getElementById(n).value}function getAntiForgeryTokenFromLayout(){return document.getElementsByName("__RequestVerificationToken")[0].value}function createLink(n,t){let i=createElement("a");return i.innerText=n,i.href=t,i}function createButton(n,t){let i=createElement("button");return i.innerText=n,i.onclick=t,i}function hideElement(n){n.style.opacity=0;setTimeout(function(){n.style.display="none"},377)}function showElement(n,t){n.style.opacity=t;setTimeout(function(){n.style.display="block"},89)}function doGet(n,t){let i=new XMLHttpRequest;i.open("GET",n,!0);i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(199<i.status&&i.status<300?t(i):i.status!=404&&console.log("error",i.status.toString(),i))};i.send(null)}function doPostWithJsonContent(n,t,i,r){doPostRequest(n,"application/json",t,i,r)}function doPostWithFormUrlEncodedContent(n,t,i,r){doPostRequest(n,"application/x-www-form-urlencoded",t,i,r)}function doPostRequest(n,t,i,r,u){let f=new XMLHttpRequest;f.open("POST",n,!0);f.setRequestHeader("Content-type",t);f.setRequestHeader("RequestVerificationToken",getAntiForgeryTokenFromLayout());f.onreadystatechange=function(){f.readyState===XMLHttpRequest.DONE&&(199<f.status&&f.status<300?r(f):u(f))};f.send(i)}function doIfConfirmed(n,t){showPopup(n.dataset.confirmTitle,n.dataset.confirmContent,!0,t)}function doRedirectIfConfirmedSuccess(n,t){showPopup(n.dataset.confirmTitle,n.dataset.confirmContent,!0,function(){doPostWithFormUrlEncodedContent(n.dataset.url,n.dataset.prm,function(n){let i=JSON.parse(n.response);if(i.isOk===!0)window.location.href=t;else{let n=i.messages.join("<br/>");showPopupMessage(n)}},function(n){let t=JSON.parse(n.response).messages.join("<br/>");showPopupMessage(t)})})}function translateScreen(){var i=document.querySelectorAll("[data-translation]"),t=JSON.parse(localStorage.getItem("labels")),n=localStorage.getItem("userLanguage");n===null&&(n="en");i.forEach(function(i){for(var u,r=0;r<t.length;r++)if(u=t[r],u.key===i.dataset.translation){u.translations.forEach(function(t){if(t.languageIsoCode2===n){i.innerHTML=t.translation;return}});break}})}function hidePopup(){popupContent.innerHTML="";hideElement(popup);hideElement(overlay)}function hidePopupMessage(){popupMessageContent.innerHTML="";hideElement(popupMessage);hideElement(overlayMessage)}function showPopup(n,t,i,r){if(document.querySelector("#popup h1").innerHTML=n,popupContent.innerHTML=t,showElement(popup,1),showElement(overlay,.8),i){let t=createButton("ok",r);t.className="btnGreen";let i=createButton("cancel",hidePopup);i.className="btnRed";let n=createElement("div");n.style.marginTop="13px";n.appendChild(t);n.appendChild(i);popupContent.appendChild(n)}}function showPopupMessage(n){document.querySelector("#popupMessage h1").innerHTML=n;showElement(popupMessage,1);showElement(overlayMessage,.8);let i=createButton("ok",function(){hidePopupMessage();hidePopup()});i.className="btnGreen";let t=createElement("div");t.style.marginTop="13px";t.appendChild(i);popupMessageContent.appendChild(t)}function getSelect(n){return document.getElementById("select-"+n)}function hasClass(n,t){return(" "+n.className+" ").indexOf(" "+t+" ")>-1}function trimSearchTerm(n,t){let r=t.childNodes;for(var i=0,u=r.length;i<u;i++)if(r[i]&&r[i].innerText&&r[i].innerText.toLowerCase()===n.trim().toLowerCase())return"";return n.trim().toLowerCase().replace(/<br>/g,"").replace(/&nbsp;/g,"")}function onSelectChange(n,t){var i=getSelect(n);i.addEventListener("theSelectChange",function(){n===this.dataset.name&&t(this.dataset.value,this.dataset.name)})}function fillTable(n,t){doGet(n,function(i){if(i!=undefined&&i.responseText!=undefined&&!(i.responseText.length<1)&&!(i.status>299)&&!(i.status<199)){let r=JSON.parse(i.responseText);appendHeader(r.headers,t);r.data.length>0&&(appendRows(r.data,t,n),r.data.length<r.pagingInfo.totalItemCount&&appendPaginationPanel(r.pagingInfo,t))}})}function appendHeader(n,t){if(!t.firstChild||t.firstChild.tagName!="THEAD"){let i=createElement("tr");if(t.dataset.selectable==="true"){let n=createElement("input");n.type="checkbox";n.onchange=function(){var i=t.lastChild.childNodes;i.forEach(function(t){t.firstChild.firstChild.checked=n.checked})};let r=createElement("th");r.className="selectable";r.appendChild(n);i.appendChild(r)}n.forEach(function(n){let t=createElement("th");t.innerHTML=n.key;t.dataset.translation=n.key;i.appendChild(t)});let r=createElement("thead");r.appendChild(i);t.appendChild(r)}}function prepareRow(n,t){let r=n.split(",_,"),i=document.createElement("tr");if(i.dataset.uid=r[0],t.dataset.selectable==="true"){let t=createElement("input");t.type="checkbox";let n=createElement("td");n.className="selectable";n.appendChild(t);i.appendChild(n)}for(let n=1;n<r.length-1;n++){let f=r[n],u=document.createElement("td"),t=createElement("input");t.type="checkbox";t.disabled="disabled";f.toLowerCase()==="true"?(t.checked="checked",u.appendChild(t)):f.toLowerCase()==="false"?u.appendChild(t):u.innerHTML=f;i.appendChild(u)}return i}function appendRows(n,t){t.firstChild.nextElementSibling&&t.firstChild.nextElementSibling.tagName=="TBODY"&&t.firstChild.nextElementSibling.remove();let i=createElement("tbody");for(let r=0;r<n.length;r++){let u=prepareRow(n[r],t);i.appendChild(u)}t.appendChild(i)}function appendPaginationPanel(n,t){t.parentElement.lastElementChild.classList.contains("pagination")&&t.parentElement.lastElementChild.remove();let i=createElement("div");i.classList="pagination";let u=t.dataset.result,e="&lastUid="+n.lastUid,f="&take="+n.take,r=n.totalItemCount-n.totalItemCount%n.take;r===n.totalItemCount&&(r=(n.totalItemCount/n.take-1)*n.take);let o=r/n.take+1;n.isHavingPrevious&&(appendGotoFirst(i,function(){updateTableRows(u,t)}),appendGotoPrevious(i,function(){updateTableRows(u+"?skip="+(n.skip-n.take)+f+e,t)}));n.type==="page_numbers"&&appendCurrentPage(i,n.currentPage);n.isHavingNext&&appendGotoNext(i,function(){updateTableRows(u+"?skip="+(n.skip+n.take)+f+e,t)});n.type==="page_numbers"&&n.isHavingNext&&appendGotoLast(i,function(){updateTableRows(u+"?skip="+r+f,t)});appendGotoPage(i,function(){var h=i.getElementsByTagName("input")[0];let o=h.value;o<1&&(o=1);let s=(o-1)*n.take;r<=s&&(s=r);updateTableRows(u+"?skip="+s+f+e,t)});appendTotalItemCount(i,n.totalItemCount);t.parentElement.appendChild(i)}function updateTableRows(n,t){doGet(n,function(i){let r=JSON.parse(i.responseText);r.pagingInfo.skip>=r.pagingInfo.totalItemCount||r.data.length===0||(clearChildren(t.lastChild),appendRows(r.data,t,n),t.parentElement.lastChild.remove(),appendPaginationPanel(r.pagingInfo,t))})}function appendGotoFirst(n,t){n.appendChild(createButton("<<",t))}function appendGotoPrevious(n,t){n.appendChild(createButton("<",t))}function appendGotoNext(n,t){n.appendChild(createButton(">",t))}function appendGotoLast(n,t){n.appendChild(createButton(">>",t))}function appendCurrentPage(n,t){let i=createElement("span");i.innerHTML=t;n.appendChild(i)}function appendGotoPage(n,t){let i=createElement("input");i.onkeypress=function(n){n.keyCode===13&&(n.preventDefault(),t())};n.appendChild(i);n.appendChild(createButton("go",t))}function appendTotalItemCount(n,t){var i=createElement("span");i.innerHTML=t+" records";n.appendChild(i)}function handleSelectedRows(n){doIfConfirmed(n,function(){let i=n.parentElement.querySelectorAll("table tbody tr"),t="";if(i.forEach(function(n){let i=n.firstChild,r=i.firstChild;r.checked&&(t+="Uids="+i.parentElement.dataset.uid+"&")}),t.length<1){showPopupMessage("please_select_at_least_one_item");return}doPostWithFormUrlEncodedContent(n.dataset.url,t,function(n){let t=JSON.parse(n.response);if(console.log(t),t.isOk===!0)i.forEach(function(n){let t=n.firstChild,i=t.firstChild;i.checked&&n.remove()}),hidePopup();else{let n=t.messages.join("<br/>");showPopupMessage(n)}},function(n){console.log(n.response);let t=JSON.parse(n.response).join("<br/>");showPopupMessage(t)})})}function handleRow(n,t,i,r){doIfConfirmed(n,function(){doPostWithFormUrlEncodedContent(i,t,r,function(n){let t=JSON.parse(n.response).join("<br/>");showPopupMessage(t)})})}function handleDeleteRow(n,t){let i=n.parentElement.parentElement.dataset.uid;handleRow(n,"id="+i,t,function(t){let i=JSON.parse(t.response);if(i.isOk===!0)n.parentElement.parentElement.remove(),hidePopup();else{let n=i.messages.join("<br/>");showPopupMessage(n)}})}function handlePostAndAppendRow(n){showPopup(n.dataset.confirmTitle,n.dataset.confirmContent,!0,function(){doPostWithFormUrlEncodedContent(n.dataset.url,n.dataset.prm,function(t){let i=JSON.parse(t.response);if(i.isOk===!0){let t=n.nextElementSibling,r=prepareRow(i.item,t);t.lastChild.appendChild(r);hidePopup()}else{let n=i.messages.join("<br/>");showPopupMessage(n)}},function(n){if(n.status==500)showPopupMessage("server_error");else{let t=JSON.parse(n.response).messages.join("<br/>");showPopupMessage(t)}})})}function handleChangeActivationRow(n,t){let i=n.parentElement.parentElement,e=i.parentElement.parentElement,u=e.firstChild,f=0;for(var r=0;r<u.firstChild.childNodes.length;r++){if(u.firstChild.childNodes[r].dataset.translation==="is_active")break;f++}let o=i.dataset.uid;handleRow(n,"id="+o,t,function(n){let r=JSON.parse(n.response);if(r.isOk===!0){var t=i.children[f];let n=t.children[0].checked,r=n===!0;t.children[0].checked=!r;hidePopup()}else{let t=JSON.parse(n.response).join("<br/>");showPopupMessage(t)}})}function handleRestoreRow(n,t,i){var r,o;let u=n.parentElement.parentElement,h=u.parentElement.parentElement,f=h.firstChild,e=0;for(r=0;r<f.firstChild.childNodes.length;r++){if(f.firstChild.childNodes[r].dataset.translation==="revision")break;e++}o=u.children[e].innerText;let s=n.parentElement.parentElement.dataset.uid;handleRow(n,"id="+s+"&revision="+o,t,function(n){let t=JSON.parse(n.response);if(t.isOk===!0)window.location.href=i+"/"+s;else{let n=t.messages.join("<br/>");showPopupMessage(n)}})}function searchWork(){let i=document.getElementById("searchResults"),t=document.getElementById("txtSearch");t.addEventListener("keydown",onUpDownKeyPress);let n=t.value;n!==lastFilter&&(_index=-1,doGet("/Label/SearchData?search="+n,function(n){199<n.status&&n.status<300&&bindLabelSearchDropdown(n.responseText)}));lastFilter=n;n==""?(hide(i),t.removeEventListener("keydown",onUpDownKeyPress)):show(i)}function bindLabelSearchDropdown(n){let t=document.getElementById("searchResults");while(t.childElementCount>1)t.removeChild(t.firstChild);let i=JSON.parse(n);if(i!=null)for(let n=0;n<i.length;n++){let u=i[n],r=document.createElement("a");r.setAttribute("uid",u.uid);r.innerHTML=u.key;t.insertBefore(r,t.firstChild)}}function openLabelSearchListPage(){window.location.href="/Label/SearchList?search="+getLabelSearchTerm()}function openLabelDetailPage(n){window.location.href="/Label/Detail/"+n}function getLabelSearchTerm(){return document.getElementById("txtSearch").value}function show(n){n!=undefined&&n.classList.add("show")}function hide(n){n!=undefined&&n.classList.remove("show")}function onUpDownKeyPress(n){let r=document.getElementById("searchResults"),t=r.getElementsByTagName("a"),i=n.which||n.keyCode;i===KEY.DOWN&&_index<t.length-1?(n.preventDefault(),_index++):i===KEY.UP&&_index>0&&(n.preventDefault(),_index--);markSelected(t,_index);i===KEY.ENTER&&(n.target.id==="txtSearch"?openLabelSearchListPage():_index===t.length-1?openLabelSearchListPage():openLabelDetailPage(t[_index].getAttribute("uid")))}function markSelected(n,t){if(n.length!==1)for(i=0;i<n.length;i++)result=n[i],i===t?result.classList.add("list-item-selected"):result.classList.remove("list-item-selected")}var popupOverlay,theSelectChangeEvent;localStorage.getItem("labels")==undefined?doGet("/Data/GetMainLabels",function(n){199<n.status&&n.status<300&&(localStorage.setItem("labels",n.responseText),translateScreen())}):translateScreen();let overlay=getElement("overlay"),overlayMessage=getElement("overlayMessage"),popup=getElement("popup"),popupContent=getElement("popupContent"),popupMessage=getElement("popupMessage"),popupMessageContent=getElement("popupMessageContent");document.getElementById("overlay")&&(popupOverlay=document.getElementById("overlay"),popupOverlay.onclick=function(){hidePopup()});theSelectChangeEvent=new Event("theSelectChange");let urlArray=[];setInterval(function(){urlArray=[]},13e3);var theTrue="True",theValueSeparator=",",refreshSelect=()=>{};(function(){function f(n,t){let i=[];t!=undefined&&(i=JSON.parse(t.responseText));hasClass(n,"single-select")&&a(n,i)}function h(t){let i=t.closest(".select");if(hasClass(i,"show"))i.classList.remove("show");else{i.classList.add("show");let t="";if(i.dataset.parent!==""&&i.dataset.parent!=undefined){let n=getSelect(i.dataset.parent);n.dataset.value!=undefined&&(t=n.dataset.value)}let u="";var r=i.lastElementChild.childElementCount;i.lastElementChild.childNodes!=undefined&&i.lastElementChild.childNodes[r]!=undefined&&r>0&&(u=i.lastElementChild.childNodes[r].getAttribute("value"));doGet(i.dataset.url+"?take="+n+"&parent="+t+"&lastUid="+u,function(n){let t=JSON.parse(n.responseText);o(i,t)})}}function e(n,t,i){let f=n.childNodes;for(var u=0,e=f.length;u<e;u++)if(f[u].innerHTML===t.text)return null;let r=createElement("div");if(r.className="select-item",i==="text")r.innerHTML=t.text;else if(i==="content"){r.classList.add("content-item");let n=createElement("img");n.className="select-item-image";n.setAttribute("src",t.image);let i=createElement("label");i.className="select-item-text";i.innerHTML=t.text;r.appendChild(n);r.appendChild(i)}return r.setAttribute("value",t.value),n.appendChild(r),r}function s(i,r){t.forEach(function(t){if(t.dataset.parent===r){let u=t.dataset.url+"?take="+n+"&parent="+i;urlArray.includes(u)||(urlArray.push(u),doGet(u,function(n){t.innerHTML="";f(t,n)}))}})}function c(t){if(t.offsetHeight+t.scrollTop>=t.scrollHeight){let i=t.closest(".select"),o=i.dataset.parent,s=trimSearchTerm(i.querySelector(".select-button-input").innerHTML,t),f=t.querySelectorAll(".select-item"),h=f.length,u=i.dataset.url+"?q="+s+"&take="+n;if(f.length>0){let n=f[h-1].getAttribute("value");u+="&lastUid="+n}if(o){let n=getSelect(o);u+="&parent="+n.dataset.value}urlArray.includes(u)||(urlArray.push(u),doGet(u,function(n){let u=JSON.parse(n.responseText),f=i.dataset.type;for(let n=0;n<u.length;n++){let o=e(t,u[n],f);o!=null&&(o.onclick=function(){hasClass(i,"single-select")&&r(this)})}}))}}function o(n,t){let i=n.querySelector(".select-content");if(t.length===0&&i.childElementCount===0){i.innerHTML=" ";let n=createElement("div");n.style.padding="5px";n.style.color="grey";n.innerHTML="no_item";n.dataset.translation="no_item";i.appendChild(n)}for(let u=0;u<t.length;u++){let f=e(i,t[u],n.dataset.type);f!=null&&(f.onclick=function(){hasClass(n,"single-select")&&r(this)})}}function l(t,r){let f=t.closest(".select"),h=f.querySelector(".select-button"),a=f.querySelector(".select-content"),c=f.dataset.parent,l=trimSearchTerm(t.innerHTML,a);if((i.length!=0||r.keyCode!=8)&&r.keyCode!=38&&r.keyCode!=40&&r.keyCode!=13&&l.length!=1){if(i==t.innerHTML){u=!0;return}i=t.innerHTML;u=!1;f.querySelector(".loader")&&f.querySelector(".loader").remove();let s=createElement("div");s.className="loader";s.style.right="-30px";h.insertBefore(s,h.firstChild);let e=f.dataset.url+"?q="+l+"&take="+n;if(c){let n=getSelect("select-"+c);n!=undefined&&n.dataset.value!=undefined&&(e+="&parent="+n.dataset.value)}urlArray.includes(e)||(urlArray.push(e),doGet(e,function(n){let t=JSON.parse(n.responseText);f.querySelector(".loader")&&f.querySelector(".loader").remove();w(f);o(f,t)}))}}function a(n,t){v(n,t);y(n,t)}function v(n,t){let r=createElement("div");r.className="select-button";let f=createElement("input");f.setAttribute("type","hidden");f.id=n.dataset.name;f.name=n.dataset.name;let e=createElement("input");e.setAttribute("type","hidden");e.id=n.dataset.nameText;e.name=n.dataset.nameText;let u=createElement("div");u.className="select-button-input";u.setAttribute("contenteditable",theTrue);let o=createButton("x",p);if(o.className="clear-select-button",r.innerHTML="",r.appendChild(f),r.appendChild(e),r.appendChild(u),r.appendChild(o),n.appendChild(r),t==undefined){r.classList.add("disabled");return}hasClass(r,"disabled")&&r.classList.remove("disabled");n.dataset.value!==""&&n.dataset.text!==""?(u.innerHTML=n.dataset.text,f.value=n.dataset.value,e.value=n.dataset.text):n.dataset.setFirstItem===theTrue&&t.length>0&&(u.innerHTML=t[0].text,f.value=t[0].value,e.value=t[0].text,n.dataset.value=t[0].value,n.dataset.text=t[0].text,n.dispatchEvent(theSelectChangeEvent),s(t[0].value,n.dataset.name));r.onclick=function(){h(this)};u.onkeydown=function(n){let t=this.closest(".select");return t.classList.add("show"),i=this.innerHTML,n.keyCode==13?(document.execCommand("insertHTML",!1,""),!1):void 0};u.onkeyup=function(n){n.preventDefault();l(this,n)}}function y(n,t){let i=createElement("div");i.className="select-content";for(let u=0;u<t.length;u++){let f=e(i,t[u],n.dataset.type);f!=null&&(f.onclick=function(){r(this)})}n.appendChild(i);i.onscroll=function(){c(this)}}function r(n){let t=n.closest(".select");var r=n.getAttribute("value"),i=n.innerHTML;t.dataset.type==="content"&&(i=n.querySelector(".select-item-text").innerHTML);t.querySelector(".select-button-input").innerHTML=i;getElement(t.dataset.name).setAttribute("value",r);getElement(t.dataset.nameText).setAttribute("value",i);t.dataset.value=r;t.dataset.text=i;s(r,t.dataset.name);t.dispatchEvent(theSelectChangeEvent);t.classList.remove("show")}function p(i){i.preventDefault();i.stopPropagation();let r=this.closest(".select"),e=r.querySelector(".select-button"),s=e.querySelector(".select-button-input");s.innerHTML="";r.dataset.value="";r.dataset.text="";getElement(r.dataset.name).value="";getElement(r.dataset.nameText).value="";let u,h=r.dataset.name;t.forEach(function(n){n.dataset.name===r.dataset.parent&&(u=n.querySelector(r.dataset.name).getAttribute("value"));n.dataset.parent===h&&(n.querySelector(".select-button").classList.add("disabled"),n.querySelector(".select-button-input").innerHTML=" ",n.querySelector(".select-content").innerHTML=" ")});let f=r.dataset.url+"?q=&take="+n;u!=undefined&&(f+="&parent="+u);urlArray.includes(f)||doGet(f,function(n){let t=JSON.parse(n.responseText);o(r,t)})}function w(n){let t=n.querySelector(".select-content");t.innerHTML=""}let n=5,i="",u=!1,t=document.querySelectorAll("div.select");refreshSelect=function(t){t.dataset.value===""&&t.dataset.text===""?t.dataset.setFirstItem===theTrue&&doGet(t.dataset.url+"?take="+n,function(n){f(t,n)}):f(t)};t.forEach(function(n){refreshSelect(n)});document.addEventListener("click",function(n){let t=document.querySelector(".select.show");t&&t.contains(n.target)==!1&&t.classList.remove("show")});document.addEventListener("keyup",function(n){let e;for(let n=0;n<t.length;n++)hasClass(t[n],"show")&&(e=t[n]);let o,i,f=-1;if(e){o=e.querySelector(".select-content");i=o.querySelectorAll(".select-item");for(let n=0;n<i.length;n++)hasClass(i[n],"hover")&&(f=n);n.keyCode==38&&(n.preventDefault(),f-1>=0&&(o.scrollTop-=i[f].offsetHeight,i[f].classList.remove("hover"),i[f-1].classList.add("hover")));n.keyCode==40&&(n.preventDefault(),f+1<i.length&&(f==-1?i[f+1].classList.add("hover"):(o.scrollTop+=i[f].offsetHeight,i[f].classList.remove("hover"),i[f+1].classList.add("hover"))));n.keyCode==13&&i[f]&&hasClass(i[f],"active")==!1&&u==!1&&hasClass(e,"single-select")&&r(i[f])}},!1)})();let tables=document.querySelectorAll("table");tables.forEach(function(n){n.dataset.result!=undefined&&fillTable(n.dataset.result,n)});let _index=-1,lastFilter="";document.onclick=function(n){let t=n.target;if(t.id!=="searchResults"||t.id!=="txtSearch"){let n=document.getElementById("searchResults");hide(n)}};let KEY={UP:38,DOWN:40,ENTER:13};